@using System.Security.Claims

@model ASP_P15.Models.Shop.ShopProductPageModel
@{
    bool isAuthenticated = Context.User.Identity?.IsAuthenticated ?? false;
    String? userId = Context.User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Sid)?.Value;
}

<div class="row">
    <div class="col col-sm-6 col-xl-4">
        <img class="product-picture" src="/Home/Download/Shop_@(Model.Product.Image)" alt="Picture" />
    </div>
    <div class="col col-6">
        <h1>@Model.Product.Name</h1>
        <p>@Model.Product.Description</p>
        <h2>₴ @Model.Product.Price.ToString("F2")</h2>
        <button class="btn btn-outline-success"><i class="bi bi-cart3"></i> До кошику</button>

        <div class="row">
            <b>Відгуки про товар:</b>

        </div>
        @if (isAuthenticated)
        {
            <div class="row">
                <b>Додати відгук:</b>
                <textarea id="product-feedback" data-user-id="@userId" data-timestamp="@DateTime.Now.Ticks" data-product-id="@Model.Product.Id"></textarea><br />
                <button id="product-feedback-button" class="btn btn-outline-info">Надіслати</button>
            </div>
        }
    </div>
</div>

@if (Model.ProductGroup.Products != null && Model.ProductGroup.Products.Any())
{
    <h2>Вас також може зацікавити</h2>
    <div class="row">
        @foreach (var product in Model.ProductGroup.Products.Where(p => p != Model.Product).Take(5))
        {
            <div class="col-sm-2 col-xl-1">
                <a asp-action="Product" asp-route-id="@(product.Slug ?? product.Id.ToString())" class="a-no-underline">
                    <div class="product-row-item">
                        <div class="image-container">
                            <img src="/Home/Download/Shop_@(product.Image)" alt="Picture" />
                        </div>
                        <p>@product.Name <br /> ₴@product.Price</p>
                        <div class="product-description">
                            <p>@product.Description</p>
                        </div>
                    </div>
                </a>
            </div>
        }
</div>
}

